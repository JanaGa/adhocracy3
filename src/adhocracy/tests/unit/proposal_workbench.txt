*** Settings ***
Documentation     Test suite for module 'Adhocracy/Frames/ProposalWorkbench'
...
...               (Detailed summary missing.)
Resource          resource.txt

*** Test Cases ***
Proposal Workbench Setup
    Setup Proposal DB

Go To Proposal Workbench
    Go To    ${PAGE URL}
    Proposal Workbench Should Be Open

Open Proposal Detail View
    Click Element               sizzle=#proposal_workbench_directory a:nth(0)
    Wait Until Page Contains Element   sizzle=#proposal_workbench_detail h3  timeout=3 secs

Open Proposal Editor
    Element Should Be Visible          sizzle=#proposal_workbench_detail .edit_button
    Click Element                      sizzle=#proposal_workbench_detail .edit_button
    Wait Until Page Contains Element   sizzle=#proposal_workbench_detail .save_button  timeout=3 secs
    Element Should Be Visible          sizzle=#proposal_workbench_detail .save_button

Edit Proposal
    Input Text                         sizzle=#proposal_workbench_detail textarea  ${PAR NEW}
    Click Element                      sizzle=#proposal_workbench_detail .save_button
    Wait Until Page Contains Element   sizzle=#proposal_workbench_detail .edit_button  timeout=3 secs

    # confirm that POST worked.
    Create Session  a3  http://localhost:8000
    ${resp}=  Get  a3  /adhocracy/p_0/p_0/v_2  # (FIXME: can we do better here than using a static url?)
    Should Be Equal As Strings  ${resp.status_code}  200

    ${jsondata}=  ToJSON  ${resp.content}
    Dictionary Should Contain Key  ${jsondata}  content_type
    Dictionary Should Contain Key  ${jsondata}  path
    Dictionary Should Contain Key  ${jsondata}  data
    Should Be Equal  ${jsondata['data']['adhocracy.propertysheets.interfaces.IParagraph']['text']}  ${PAR NEW}

    # confirm that re-render worked.  (FIXME: wait for this with timeout=3 secs)
    Element Should Contain  sizzle=#proposal_workbench_detail  ${PAR NEW}

Create New Paragraph
    Click Element  sizzle=.create_paragraph_button
    Wait Until Page Contains Element  sizzle=#proposal_workbench_detail not_sure_how_to_proceed_from_here

Create New Proposal
    Click Element  sizzle=.create_proposal_button
    Wait Until Page Contains Element  sizzle=#proposal_workbench_detail not_sure_how_to_proceed_from_here


# edit two paragraphs simultaneously (see ../adhocracy/frontend/static/00_attic/frontend.js)
# edit mode for proposals (not individual paragraphs)
# if document is in edit mode: always add an empty new paragraph at the end.
# if and only if there is any text in it when document is saved, a new paragraph will be appended to the document.
# (empty paragraph also has the save button that works as usual.)
# delete button for paragraphs.  saving empty paragraphs also deletes paragraph.
# edit several paragraphs simultaneously.  save all of them by saving the document (huh - complex)
# move paragraphs (d3js)
# filter search for proposals (?)


[Teardown]  Close Browser
