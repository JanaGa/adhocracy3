*** Settings ***
Documentation     Test suite for module 'Adhocracy/Frames/ProposalWorkbench'
...
...               (Detailed summary missing.)
Resource          resource.txt

*** Test Cases ***
Proposal Workbench Setup
    Setup Proposal DB

Go To Proposal Workbench
    Go To    ${PAGE URL}
    Proposal Workbench Should Be Open

Open Proposal Detail View
    Click Element               sizzle=#proposal_workbench_directory a:nth(0)
    Wait Until Page Contains Element   sizzle=#proposal_workbench_detail h3  timeout=3 secs

Open Proposal Editor
    Element Should Be Visible          sizzle=#proposal_workbench_detail .edit_button
    Click Element                      sizzle=#proposal_workbench_detail .edit_button
    Wait Until Page Contains Element   sizzle=#proposal_workbench_detail .save_button  timeout=3 secs
    Element Should Be Visible          sizzle=#proposal_workbench_detail .save_button

Edit Proposal
    Input Text                         sizzle=#proposal_workbench_detail textarea  ${PAR NEW}
    Click Element                      sizzle=#proposal_workbench_detail .save_button
    Wait Until Page Contains Element   sizzle=#proposal_workbench_detail .edit_button  timeout=3 secs

    # confirm that POST worked.
    Create Session  a3  http://localhost:8000
    ${resp}=  Get  a3  /adhocracy/p_0/p_0/v_2  # (FIXME: can we do better here than using a static url?)
    Should Be Equal As Strings  ${resp.status_code}  200

    ${jsondata}=  ToJSON  ${resp.content}
    Dictionary Should Contain Key  ${jsondata}  content_type
    Dictionary Should Contain Key  ${jsondata}  path
    Dictionary Should Contain Key  ${jsondata}  data
    Should Be Equal  ${jsondata['data']['adhocracy.propertysheets.interfaces.IParagraph']['text']}  ${PAR NEW}

    # confirm that re-render worked.  (FIXME: wait for this with timeout=3 secs)
    Element Should Contain  sizzle=#proposal_workbench_detail  ${PAR NEW}

[Teardown]  Close Browser
