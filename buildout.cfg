[buildout]
extends =
    src/adhocracy_core/sources.cfg
    src/adhocracy_core/base.cfg
    src/adhocracy_core/checkcode.cfg
    src/adhocracy_core/sphinx.cfg
    src/adhocracy_frontend/sources.cfg
    src/adhocracy_frontend/base.cfg
    src/adhocracy_frontend/checkcode_and_compile.cfg
develop =
    .
    src/adhocracy_core
    src/adhocracy_mercator
    src/adhocracy_sample
    src/adhocracy_frontend
parts +=
    make_wheels

[adhocracy]
frontend.static_dir = src/mercator/build

[test_run_unit]
package_paths = src/adhocracy_core src/adhocracy_mercator src/adhocracy_sample

[test_run_all]
package_paths = src/mercator/tests src/adhocracy_frontend/adhocracy_frontend/tests ${test_run_unit:package_paths}

[merge_static_directories]
static_directories = src/mercator/static ${adhocracy:frontend.core.static_dir}

[supervisor]
groups =
    10 adhocracy zeo,autobahn,backend,frontend
    20 adhocracy_test test_zeo,test_autobahn,test_backend,test_frontend

[sphinx_documentation]
recipe = zc.recipe.egg
dependent-scripts = true
eggs +=
       mercator[debug]
       adhocracy_mercator[debug]
[eggs]


[make_wheels]
recipe = collective.recipe.template
input = inline:
    #!/bin/bash
    set -e

    # this needs to be installed into to the virtualenv / system python not into /eggs
    ${buildout:bin-directory}/pip install wheel --upgrade
    WHEEL_REPOSITORY=parts/wheels
    ${buildout:bin-directory}/pip wheel --wheel-dir=$WHEEL_REPOSITORY src/substanced
    ${buildout:bin-directory}/pip wheel --wheel-dir=$WHEEL_REPOSITORY --find-links $WHEEL_REPOSITORY src/adhocracy_core
    ${buildout:bin-directory}/pip wheel --wheel-dir=$WHEEL_REPOSITORY --find-links $WHEEL_REPOSITORY src/adhocracy_mercator
    ${buildout:bin-directory}/pip wheel --wheel-dir=$WHEEL_REPOSITORY --find-links $WHEEL_REPOSITORY src/adhocracy_frontend
    ${buildout:bin-directory}/pip wheel --wheel-dir=$WHEEL_REPOSITORY --find-links $WHEEL_REPOSITORY .
output = ${buildout:bin-directory}/make_wheels
mode = 755
